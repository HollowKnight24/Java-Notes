# 事务
事务是逻辑上的一组操作，要么全执行，要么全不执行。  

四大特效  
原子性：事务是最小的执行单位，不允许被分割，要么全执行，要么全不执行。  
一致性：执行事务前后，数据保持一致，多个事务对同一事务的数据读取结果是一样的。  
隔离性：并发访问数据库时，一个用户的事务不会被其他事务干扰，即对其他事务是不可见的。  
持久性：一旦事务提交，对数据库的改变是永久的，故障了也不会改变。  

并发事务的问题  
脏读：一个事务正在访问一个数据并对其修改，然而还没有提交或撤销了，此时另一个事务也访问这个数据，并用这个未修改的数据或撤销前的数据进行操作，那么这个事务读取的数据就是脏数据。  
丢失修改：指两个事务同时访问一个数据时，一个事务的更新操作被另一个事务的更新操作覆盖。  
不可重复读：一个事务多次读取一个数据时，在事务未完成时，另一个事务对这个数据进行了修改，导致第一个事务两次读取的数据不一致。  
幻读：与不可重复读类似，一个事务多次读取某个范围的数据，另一个事务在这个范围内插入了新数据，导致第一个事务两次读取的数据范围的内容不一致。  

事务隔离级别  
未提交读取：允许读取未提交的数据，会导致脏读、不可重复读和幻读。  
提交读取：只能读取已提交的数据，可避免脏读。  
可重复读：保证同一事务中多次读取的数据一致，可避免脏读和不可重复读。  
可串行化：所有事务依次逐个执行，避免所有并发的问题。  

# 大表优化
限定查找数据的范围：禁止不带任何限制条件的查询。  
读写分离：主库写，从库读。  
垂直分区：对列的拆分，一张列比较多的表拆分成多个表，但是主键会冗余。  
水平分区：对行的拆分。  

# B+ Tree
B树是平衡树，所有叶子节点在同一层。  
B+树非叶子节点只存储索引，数据只存储在叶子节点，叶子节点成一有序链表，一个节点的key从左到右递减，如果一个指针左右相邻的key分别为key i和key i+1，那么该指针指向的节点的所有key
满足key i <=key<= key i+1。  

MySQL的InnoDB引擎使用B+树索引，分为主索引和辅助索引，主索引的叶节点的data域记录数据，辅助索引的叶节点的data域记录主键值，使用辅助索引时要先找到主键值，再到主索引中查找数据。  

InnoDB和MyISAM  
InnoDB是事务型的，MyISAM不支持事务。  
MyISAM只支持表级锁，InnoDB还支持行级锁。  
InnoDB支持外键。  
MyISAM崩溃后损害的概率较大。  

